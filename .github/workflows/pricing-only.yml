name: Pricing and Availability Configuration

on:
  workflow_dispatch:
    inputs:
      bundle_identifier:
        description: 'App Bundle ID'
        required: true
        type: string

jobs:
  configure-pricing:
    runs-on: macos-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Setup Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: '3.1'
      
    - name: Install Fastlane
      run: gem install fastlane
      
    - name: Configure Pricing and Availability
      env:
        APP_STORE_CONNECT_API_KEY_KEY_ID: ${{ secrets.APP_STORE_CONNECT_API_KEY_KEY_ID }}
        APP_STORE_CONNECT_API_KEY_ISSUER_ID: ${{ secrets.APP_STORE_CONNECT_API_KEY_ISSUER_ID }}
        APP_STORE_CONNECT_API_KEY_KEY: ${{ secrets.APP_STORE_CONNECT_API_KEY_KEY }}
        FASTLANE_SESSION: ${{ secrets.FASTLANE_SESSION }}
        FASTLANE_SKIP_2FA_UPGRADE: 1
        FASTLANE_HIDE_CHANGELOG: 1
      run: |
        echo "üè™ Starting Pricing and Availability Configuration"
        echo "üì± Bundle ID: ${{ github.event.inputs.bundle_identifier }}"
        fastlane configure_pricing_and_availability bundle_id:"${{ github.event.inputs.bundle_identifier }}"
