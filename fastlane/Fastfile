default_platform(:ios)

platform :ios do
  desc "Setup app availability for all countries - ManzTestApp2025"
  lane :setup_availability_manz do
    app_id = "6753968771"
    
    UI.message("üöÄ Setting up worldwide availability for ManzTestApp2025")
    UI.message("üì± App ID: #{app_id}")
    
    begin
      require 'json'
      
      # Skip privacy details for now and focus on availability
      UI.message("‚è≠Ô∏è Skipping privacy details upload - focusing on availability setup")
      
      # Use produce to ensure app is properly configured
      UI.message("üì± Configuring app with produce...")
      produce(
        username: "dohrasanket@gmail.com",
        app_identifier: "com.san.mainAp",
        app_name: "ManzTestApp2025",
        language: "en-US",
        app_version: "1.0",
        sku: "ManzTestApp2025",
        skip_itc: false,
        skip_devcenter: true
      )
      
      # Use deliver to set up metadata and availability
      UI.message("üìä Using deliver to configure app metadata and availability...")
      deliver(
        username: "dohrasanket@gmail.com",
        app_identifier: "com.san.mainAp",
        skip_binary_upload: true,
        skip_screenshots: true,
        skip_metadata: false,
        force: true,
        overwrite_screenshots: false,
        submit_for_review: false,
        automatic_release: false,
        skip_app_version_update: true,
        
        # App metadata
        app_version: "1.0",
        copyright: "¬© 2025 ManzzPlusApp",
        primary_category: "UTILITIES",
        secondary_category: "PRODUCTIVITY",
        
        # Pricing - Free
        price_tier: 0,
        
        # Localized content for major territories
        name: {
          "en-US" => "ManzTestApp2025",
          "en-GB" => "ManzTestApp2025", 
          "de-DE" => "ManzTestApp2025",
          "fr-FR" => "ManzTestApp2025",
          "ja" => "ManzTestApp2025"
        },
        
        description: {
          "en-US" => "ManzTestApp2025 - A comprehensive utility application designed to enhance your productivity and streamline your daily tasks with powerful tools and features.",
          "en-GB" => "ManzTestApp2025 - A comprehensive utility application designed to enhance your productivity and streamline your daily tasks with powerful tools and features.",
          "de-DE" => "ManzTestApp2025 - Eine umfassende Utility-Anwendung zur Steigerung Ihrer Produktivit√§t und Optimierung Ihrer t√§glichen Aufgaben.",
          "fr-FR" => "ManzTestApp2025 - Une application utilitaire compl√®te con√ßue pour am√©liorer votre productivit√© et rationaliser vos t√¢ches quotidiennes.",
          "ja" => "ManzTestApp2025 - ÁîüÁî£ÊÄß„ÇíÂêë‰∏ä„Åï„Åõ„ÄÅÊó•Â∏∏„ÅÆ„Çø„Çπ„ÇØ„ÇíÂäπÁéáÂåñ„Åô„Çã„Åü„ÇÅ„ÅÆÂåÖÊã¨ÁöÑ„Å™„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÄÇ"
        },
        
        keywords: {
          "en-US" => "utility,productivity,tools,manz,app,efficiency",
          "en-GB" => "utility,productivity,tools,manz,app,efficiency",
          "de-DE" => "dienstprogramm,produktivit√§t,werkzeuge,manz,app,effizienz",
          "fr-FR" => "utilitaire,productivit√©,outils,manz,app,efficacit√©", 
          "ja" => "„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£,ÁîüÁî£ÊÄß,„ÉÑ„Éº„É´,manz,„Ç¢„Éó„É™,ÂäπÁéá"
        },
        
        release_notes: {
          "en-US" => "Welcome to ManzTestApp2025! This initial release brings you powerful utility features to enhance your daily productivity. Get started with our comprehensive toolset designed for efficiency.",
          "en-GB" => "Welcome to ManzTestApp2025! This initial release brings you powerful utility features to enhance your daily productivity. Get started with our comprehensive toolset designed for efficiency.",
          "de-DE" => "Willkommen bei ManzTestApp2025! Diese erste Version bietet Ihnen leistungsstarke Utility-Funktionen zur Steigerung Ihrer t√§glichen Produktivit√§t.",
          "fr-FR" => "Bienvenue dans ManzTestApp2025! Cette version initiale vous apporte des fonctionnalit√©s utilitaires puissantes pour am√©liorer votre productivit√© quotidienne.",
          "ja" => "ManzTestApp2025„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ„Åì„ÅÆÂàùÂõû„É™„É™„Éº„Çπ„Åß„ÅØ„ÄÅÊó•Â∏∏„ÅÆÁîüÁî£ÊÄß„ÇíÂêë‰∏ä„Åï„Åõ„ÇãÂº∑Âäõ„Å™„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Ê©üËÉΩ„Çí„ÅäÂ±ä„Åë„Åó„Åæ„Åô„ÄÇ"
        },
        
        support_url: {
          "en-US" => "https://manzz.app/support"
        },
        
        marketing_url: {
          "en-US" => "https://manzz.app"
        },
        
        privacy_url: {
          "en-US" => "https://manzz.app/privacy"
        },
        
        # App review information
        app_review_information: {
          contact_email: "dohrasanket@gmail.com",
          contact_first_name: "SANKETKUMAR",
          contact_last_name: "DOHRA",
          contact_phone: "+91 9265171259",
          demo_account_name: "",
          demo_account_password: "",
          notes: "ManzTestApp2025 is a utility application designed for productivity enhancement. The app is free and intended for worldwide distribution. No special review requirements."
        },
        
        # Submission information for export compliance
        submission_information: {
          export_compliance_platform: "ios",
          export_compliance_compliance_required: false,
          export_compliance_encryption_updated: false,
          export_compliance_app_type: nil,
          export_compliance_uses_encryption: false,
          export_compliance_is_exempt: true,
          export_compliance_contains_third_party_cryptography: false,
          export_compliance_contains_proprietary_cryptography: false,
          export_compliance_available_on_french_store: false
        }
      )
      
      UI.success("‚úÖ Successfully configured app metadata and availability!")
      UI.message("üéâ App should now be available worldwide with proper configuration!")
      UI.message("üîó Check App Store Connect: https://appstoreconnect.apple.com/apps/#{app_id}/distribution/pricing")
      
    rescue => e
      UI.error("‚ùå Setup failed: #{e.message}")
      UI.message("üí° Error details: #{e.backtrace.first(3).join('\n')}")
    end
  end

  desc "Build and archive iOS app"
  lane :build_archive do |options|
    app_name = options[:app_name] || "MyApp"
    
    if Dir.glob("*.xcworkspace").any?
      workspace = Dir.glob("*.xcworkspace").first
      scheme = File.basename(workspace, ".xcworkspace")
      
      build_app(
        workspace: workspace,
        scheme: scheme,
        configuration: "Release",
        export_method: "app-store"
      )
    elsif Dir.glob("*.xcodeproj").any?
      project = Dir.glob("*.xcodeproj").first
      scheme = File.basename(project, ".xcodeproj")
      
      build_app(
        project: project,
        scheme: scheme,
        configuration: "Release", 
        export_method: "app-store"
      )
    end
  end
end
